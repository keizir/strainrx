{% extends "base.html" %}

{% load staticfiles i18n %}
{% load search_template_tags %}

{% block title %}Search Results{% endblock %}

{% block css %}
    {{ block.super }}
    <link href="{% static 'css/pages/search/strain/search_results.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="container search-result-container">
        <div class="search-result-header-wrapper">
            <h1>Here Are Your Top Recommendations</h1>
            <div class="filter-menu-wrapper">
                <div class="filter-menu">
                    <div class="active-link">
                        <span class="menu-active-link">
                            <a href="#">Show All</a>
                        </span>
                        <span class="menu-expander">
                            <i class="fa fa-caret-down" aria-hidden="true"></i>
                        </span>
                    </div>
                    <div class="hidden-links hidden">
                        <span class="menu-link">
                            <a href="#">Show All</a>
                        </span>
                        <span class="menu-link">
                            <a href="#">Available Locally</a>
                        </span>
                        <span class="menu-link">
                            <a href="#">Deliveries Only</a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="search-result-body-wrapper">
            <div class="search-result">
                {% for strain in search_results %}
                    <div class="result-item">
                        <div class="item-info-wrapper inline-block">
                            <div class="item-image inline-block">
                                {% if strain.image_url %}
                                    <img src="{{ strain.image_url }}" alt="Strain Image">
                                {% else %}
                                    <img src="{% static 'images/weed_small.jpg' %}" alt="Strain Image"/>
                                {% endif %}
                            </div>
                            <div class="item-info inline-block">
                                <span class="strain-name">
                                    <a href="{% url 'search:strain_detail' slug_name=strain.strain_slug %}">{{ strain.name }}</a>
                                </span>
                                <span class="strain-type">{{ strain.variety }}</span>
                                <span class="strain-rating">{{ strain.rating }}</span>
                            </div>
                        </div>
                        <div class="separator inline-block"></div>
                        <div class="item-locations inline-block">
                            <span class="locations-icon">
                                <i class="fa fa-map-marker fa-2x" aria-hidden="true"></i>
                            </span>
                            <span class="locations">
                                <span>{{ strain.delivery_addresses|length }} Locations</span>
                                <span>{% find_closest_delivery_distance strain.delivery_addresses %}</span>
                                <span>{% count_open_close_deliveries strain.delivery_addresses %}</span>
                            </span>
                        </div>
                        <div class="separator inline-block"></div>
                        <div class="item-deliveries inline-block">
                            <span class="deliveries-icon">
                                <i class="fa fa-truck fa-2x" aria-hidden="true"></i>
                            </span>
                            <span class="deliveries">
                                <span>1 Delivery Service Closed</span>
                            </span>
                        </div>
                        <div class="separator inline-block"></div>
                        <div class="item-percentage-match inline-block">
                            <span class="percentage">{{ strain.match_percentage }}%</span>
                            <span class="match">match</span>
                        </div>
                    </div>

                    {% empty %}
                    <p>Sorry, no results found.</p>
                {% endfor %}
            </div>
        </div>
        <div class="search-result-footer-wrapper {% if search_results_total <= 8 %}hidden{% endif %}">
            <div class="scroll-down-wrapper">
                <div class="inline-block">
                    <span class="scroll-icon">
                        <i class="fa fa-refresh fa-2x" aria-hidden="true"></i>
                    </span>
                </div>
                <div class="inline-block">
                    <span class="scroll-text">
                        Scroll down to load more results
                    </span>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script src="{% static 'js/pages/search/strain/search_results.js' %}"></script>
    <script type="text/javascript">
        new W.pages.StrainSearchResultsPage();
    </script>
    <script type="x/srx-template" id="strain-item-template">
        <div class="result-item">
            <div class="item-info-wrapper inline-block">
                <div class="item-image inline-block">
                    <% if (strain.image_url !== null) { %>
                    <img src="${ strain.image_url }" alt="Strain Image">
                    <% } else { %>
                    <img src="{% static 'images/weed_small.jpg' %}" alt="Strain Image"/>
                    <% } %>
                </div>
                <div class="item-info inline-block">
                <span class="strain-name">
                    <a href="/search/strain/${ strain.strain_slug }"><%= strain.name %></a>
                </span>
                    <span class="strain-type">${ strain.variety }</span>
                    <span class="strain-rating loaded-rating-<%= position %>">${ strain.rating }</span>
                </div>
            </div>
            <div class="separator inline-block"></div>
            <div class="item-locations inline-block">
            <span class="locations-icon">
                <i class="fa fa-map-marker fa-2x" aria-hidden="true"></i>
            </span>
                <span class="locations">
                <span>${ strain.delivery_addresses.length } Locations</span>
                <span>${ closestDeliveryDistance }</span>
                <span>${ openClosedCount }</span>
            </span>
            </div>
            <div class="separator inline-block"></div>
            <div class="item-deliveries inline-block">
            <span class="deliveries-icon">
                <i class="fa fa-truck fa-2x" aria-hidden="true"></i>
            </span>
                <span class="deliveries">
                <span>1 Delivery Service Closed</span>
            </span>
            </div>
            <div class="separator inline-block"></div>
            <div class="item-percentage-match inline-block">
                <span class="percentage">${ strain.match_percentage }%</span>
                <span class="match">match</span>
            </div>
        </div>
    </script>
{% endblock %}
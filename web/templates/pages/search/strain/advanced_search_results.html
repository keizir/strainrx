{% extends "pages/search/strain/advanced_search.html" %}

{% load staticfiles i18n %}

{% block title %}Strain Search{% endblock %}

{% block css %}
  {{ block.super }}
  <link href="{% static 'css/pages/base.css' %}" rel="stylesheet">
  <link href="{% static 'css/pages/search/strain/advanced_search.css' %}" rel="stylesheet">
{% endblock %}

{% block body_class %} class="search-result-page"{% endblock body_class %}

{% block form_content %}

  <div class="search-container"></div>

  <div class="search-result-footer-wrapper hidden">
    <div class="scroll-down-wrapper">
      <div class="inline-block">
        <span class="scroll-icon"><i class="fa fa-refresh fa-2x" aria-hidden="true"></i></span>
      </div>
      <div class="inline-block">
        <span class="scroll-text">{% trans 'Scroll down to load more results' %}</span>
      </div>
    </div>
  </div>
  {% include 'pages/search/strain/inlines/dialog.html' %}
{% endblock %}

{% block javascript %}
  {{ block.super }}
  <script src="{% static 'url-search-params-polyfill/index.js' %}"></script>
  <script src="{% static 'js/pages/search/strain/advanced_search_results.js' %}"></script>
  <script type="text/javascript">
      new W.pages.AdvancedSearchResultsPage({
          'currentUserId': '{{ request.user.id }}',
          'isEmailVerified': '{{ request.user.is_email_verified }}' === 'True'
      });
  </script>

  <script type="x/srx-template" id="strain-result-template">
    <div class="search-result-header-wrapper">
      <% if (isBasicSearch) { %>
        <% if (searchResults.length) { %>
          <div class="search-result-subtitle">{% trans 'Search Results' %}</div>
        <% } %>
      <% } else { %>
        <% if (searchResults.length) { %>
          <div class="search-result-subtitle">{% trans 'Here Are Your Top Recommendations' %}</div>
          <div class="filter-menu-wrapper">
            <div class="form-field-group">
              <span class="filter-title">{% trans 'Sort' %}:</span>
              <span class="form-field">
                <input type="checkbox" name="sort" id="sort-1" value="">
                <label for="sort-1">{% trans 'Best Match' %}</label>
              </span>
              <span class="form-field">
                <input type="checkbox" name="sort" id="sort-2" value="location">
                <label for="sort-2">{% trans 'Nearest' %}</label>
              </span>
              <span class="form-field">
                <input type="checkbox" name="sort" id="sort-3" value="name">
                <label for="sort-3">{% trans 'Name' %}</label>
              </span>
              <span class="form-field">
                <input type="checkbox" name="sort" id="sort-4" value="price">
                <label for="sort-4">{% trans 'Price' %}</label>
              </span>
            </div>
          </div>
        <% } %>
      <% } %>
    </div>
    <div class="search-result-body-wrapper">

      <% if (searchResults.length) { %>
        <div class="search-result<% if (isBasicSearch) { %> basic-search<% } %>"></div>
      <% } else { %>
        <% if (q && q.length) { %>
          <div class="search-result-subtitle">
            We could not find a match for
            <i class="fa fa-angle-double-left"></i><b>${ q }</b><i class="fa fa-angle-double-right"></i>
          </div>
        <% } else { %>
          <div class="search-result-subtitle">No Results Found</div>
        <% } %>
      <% } %>

      <% if (similarResult.length) { %>
        <div class="search-result-subtitle">{% trans 'Similar Strains:' %}</div>
        <div class="similar-result"></div>
      <% } %>
    </div>
  </script>

  <script type="x/srx-template" id="strain-item-template">
    <div class="result-item<% if (isBasicSearch) { %> basic-search<% } %>">
      <div class="item-image">
        <% if (strain.image_url) { %>
        <img class="strain-logo" src="${ strain.image_url }" alt="Strain Image">
        <% } else { %>
        <img class="strain-logo" src="{% static 'images/weed_small.jpg' %}" alt="Strain Image"/>
        <% } %>
        <% if (!isBasicSearch) { %>
          <% if (strain.is_clean) { %>
            <img class="clean-logo" src="{% static 'images/search/clean.png' %}">
          <% } %>
        <% } %>
      </div>
      <% if (!isBasicSearch) { %>
        <% if (strain.locations && strain.locations.length) { %>
          <span class="item-location"><i class="fa fa-map-marker"></i> ${ closestDistance(strain.locations) } Miles away</span>
        <% } %>
      <% } %>

      <div class="item-info">
        <div>
          <% if (isBasicSearch) { %>
            <div class="item-variety-logo">
              <img src="{% static 'images/search/' %}${ strain.variety }-leaf.png">
            </div>
          <% } %>
          <div class="strain-name">
              <% if (obfuscated) { %>
                <a class="blurred noselect">${ strain.name }</a>
              <% } else { %>
                  <b><a href="/strains/${ strain.variety }/${ strain.strain_slug }/">${ strain.name }</a></b>
              <% } %>
          </div>
          <div class="strain-type">${ _.startCase(strain.variety) }</div>
        </div>


        <% if (strain.about) { %>
          <div class="strain-about">${ strain.about }</div>
        <% } %>
        <% if (strain.cannabinoids) { %>
          <div class="strain-cannabinoids"><b>
            <% _.forEach(strain.cannabinoids, function(value, key) { %>
            <% if (value) { %>
            <span><%- value %>% <%- key.toUpperCase() %></span>
            <% } %>
            <% }); %>
          </b></div>
        <% } %>
        <% if ( strain.locations.length && prices ) { %>
          <div class="strain-price">
            <% if ( prices.price_gram.min != prices.price_gram.max ) { %>
              ${ prices.price_gram.min } - ${ prices.price_gram.max }/G
            <% } else { %>
              ${ prices.price_gram.min }/G
            <% } %>

            <% if ( prices.price_eighth.min != prices.price_eighth.max ) { %>
              ${ prices.price_eighth.min } - ${ prices.price_eighth.max }/8th
            <% } else { %>
              ${ prices.price_eighth.min }/8th
            <% } %>

            <% if ( prices.price_quarter.min != prices.price_quarter.max ) { %>
              ${ prices.price_quarter.min } - ${ prices.price_quarter.max }/Q
            <% } else { %>
              ${ prices.price_quarter.min }/Q
            <% } %>
          </div>
        <% } %>

        <% if (isBasicSearch) { %>
          <% if (strain.locations && strain.locations.length) { %>
            <span class="item-location"><i class="fa fa-map-marker"></i> ${ closestDistance(strain.locations) } Miles away</span>
          <% } %>
        <% } %>
        <div>
        <% if (strain.cup_winner) { %>
          <img class="cup-logo" src="{% static 'images/search/cup.png' %}">
        <% } %>
        </div>
      </div>

      <% if (!isBasicSearch || strain.is_clean) { %>
        <div class="item-variety-logo">
          <% if (!isBasicSearch) { %>
          <img src="{% static 'images/search/' %}${ strain.variety }-leaf.png">
          <% } else { %>
              <% if (strain.is_clean) { %>
                <img class="clean-logo" src="{% static 'images/search/clean.png' %}">
              <% } %>
          <% } %>
        </div>
      <% } %>
    </div>
  </script>
{% endblock %}

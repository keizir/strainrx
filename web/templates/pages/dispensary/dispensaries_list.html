{% extends "base.html" %}

{% load staticfiles i18n %}

{% block title %}Marijuana Dispensaries, Easily Find Cannabis Near You{% endblock %}

{% block css %}
    {{ block.super }}
    <link href="{% static 'css/pages/dispensary/dispensaries.css' %}" rel="stylesheet">
    <link href="{% static 'css/common/location_plus_favourites.css' %}" rel="stylesheet">
{% endblock %}

{% block meta %}
    {{ block.super }}
    <meta name="Description"
          content="Marijuana dispensaries near you. Find the best rated, compare prices, or find local deals.">
{% endblock %}

{% block content %}
    <div class="disp-row-01">
        <div class="container">
            {% include 'pages/common/location_plus_favourites.html' %}
            <div class="disp-sub-row-02">
                <h1>Find a Dispensary</h1>
                <div class="subtitle-container">
                    <hr/>
                    <p class="subtitle">Search Local Dispensaries by Name</p>
                    <hr/>
                </div>
                <div class="search-box">
                    <div class="search-form">
                        <div class="form-field dispensary-name-field">
                            <label for="disp-lookup" class="disp-lookup-label">
                                <i class="fa fa-search" aria-hidden="true"></i>
                            </label>
                            <input id="disp-lookup" class="lookup-input" type="text" placeholder="Search Dispensaries by Name"/>
                            <div class="payloads-region"></div>
                        </div>
                        <div class="disp-location-container">
                            <label for="disp-location" class="disp-location-label">
                                <i class="fa fa-dot-circle-o" aria-hidden="true"></i>
                            </label>
                            <input id="disp-location" type="text" class="disp-location-value"
                                   placeholder="Filter by Location"/>
                        </div>
                    </div>
                </div>
                <!--<a class="find-delivery" href="#">or Find Delivery Service</a>-->
            </div>
        </div>
    </div>
    <div class="dispensaries-list-container container">
        <h2>Dispensaries</h2>
        <div class="social-icons">
            <span class="social-fb">
                <a href="#" class="facebook-share-link" target="_blank">
                    <i class="fa fa-facebook-square" aria-hidden="true"></i>
                </a>
            </span>
            <span class="social-google">
                <a href="#" class="google-share-link" target="_blank">
                    <i class="fa fa-google-plus-square" aria-hidden="true"></i>
                </a>
            </span>
            <span class="social-twitter">
                <a href="#" class="twitter-share-link" target="_blank">
                    <i class="fa fa-twitter-square" aria-hidden="true"></i>
                </a>
            </span>
        </div>
        <div class="breadcrumbs">
            <ol>
                <li>
                    <a href="{% url 'home' %}">Home</a>
                    <span class="arrow">></span>
                </li>
                <li class="active">Dispensaries</li>
            </ol>
        </div>
        <div class="featured-wrapper">
            <h3>Featured Dispensaries Near You</h3>

            {# There's a template used in ajax update which has to be modified together with #}
            {# the featured-list contents below #}
            <div class="featured-list">
            {% for f in  featured %}
                <div class="col-3">
                    <div class="featured-item">
                        <h4 class="featured-header">
                            <a href="{{ f.url }}">{{ f.location_name }}</a>
                        </h4>
                        <div class="featured-content">
                            <div class="featured-image">
                                <a href="{{ f.url }}">
                                    <img src="{{ f.image_url }}" onerror="this.src = '{{ f.DEFAULT_IMAGE_URL }}';">
                                </a>
                            </div>
                            <div class="featured-detail-list">
                                <div class="featured-detail">
                                    <i class="fa fa-map-marker"></i>
                                    <div class="featured-detail-line-wrapper">
                                        <div class="featured-detail-line">{{ f.street1 }}</div>
                                        <div class="featured-detail-line">{{ f.city }}, {{ f.state }}, {{ f.zip_code }}</div>
                                    </div>
                                </div>

                                <div class="featured-detail">
                                    <i class="fa fa-phone"></i>
                                    <div class="featured-detail-line-wrapper">
                                        <div class="featured-detail-line">{{ f.phone }}</div>
                                    </div>
                                </div>

                                <div class="featured-detail">
                                    <i class="fa fa-envelope"></i>
                                    <div class="featured-detail-line-wrapper">
                                        <a class="featured-detail-line" href="mailto:{{ f.location_email }}">{{ f.location_email }}</a>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>
            <script type="x/srx-template" id="featured-locations-template">
                <div class="col-3">
                    <div class="featured-item">
                        <h4 class="featured-header">
                            <a href="<%= url %>"><%= location_name %></a>
                        </h4>
                        <div class="featured-content">
                            <div class="featured-image">
                                <a href="<%= url %>">
                                    <img src="<%= image_url %>" onerror="this.src = '<%= default_image_url %>';">
                                </a>
                            </div>
                            <div class="featured-detail-list">
                                <div class="featured-detail">
                                    <i class="fa fa-map-marker"></i>
                                    <div class="featured-detail-line-wrapper">
                                        <div class="featured-detail-line"><%= street1 %></div>
                                        <div class="featured-detail-line"><%= city %>, <%= state %>, <%= zip_code %></div>
                                    </div>
                                </div>

                                <div class="featured-detail">
                                    <i class="fa fa-phone"></i>
                                    <div class="featured-detail-line-wrapper">
                                        <div class="featured-detail-line"><%= phone %></div>
                                    </div>
                                </div>

                                <div class="featured-detail">
                                    <i class="fa fa-envelope"></i>
                                    <div class="featured-detail-line-wrapper">
                                        <a class="featured-detail-line" href="mailto:<%= location_email %>"><%= location_email %></a>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </script>
        </div>
        <div class="text">
            StrainRx is dedicated to helping cannabis users find the optimal strains to medicate with, depending on
            their unique needs and conditions. Weâ€™ll help you make sense of the thousands of strains and countless
            vendors across the 28 states (plus the District of Columbia) where marijuana is permitted for medical and/or
            recreational use.
        </div>
        <div class="text">
            Please note that each state has its own restrictions on possessing marijuana lawfully and users should
            understand and adhere to the rules and regulations that govern their respective city and state.
        </div>
        <div class="text">
            Users can find information on dispensaries in the following states:
        </div>
        <h3>Dispensaries by State</h3>
        {% for s in states %}
            <div class="states-wrapper">
                <a href="{% url 'businesses:dispensaries_state_list' s.abbreviation|lower %}">
                    {% if s.full_name %}{{ s.full_name }}{% else %}{{ s.abbreviation }}{% endif %}</a>
                <div class="description">
                    {% if s.description %}{{ s.description|safe }}{% else %}No data about this state{% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    {% include 'common/dispensary_lookup.html' %}
{% endblock %}

{% block javascript %}
    {{ block.super }}

    <script src="{% static 'js/views/location_view.js' %}"></script>
    <script src="{% static 'js/pages/location.js' %}"></script>
    <script type="text/javascript">
        W.Location.init({
            location: {% if request.user.is_authenticated %}
                {{ request.user.get_location_json | safe }} {% else %} null {% endif %},
            authenticated: '{{ request.user.is_authenticated }}' == 'True',
            userId: '{{ request.user.id }}'
        });
    </script>

    <script src="{% static 'js/pages/dispensary/dispensary_lookup.js' %}"></script>
    <script src="{% static 'js/pages/dispensary/dispensaries.js' %}"></script>
    <script type="text/javascript">
        var DispensaryPage = new W.pages.dispensary.Dispensaries({
            location: {% if request.user.is_authenticated %}
                {{ request.user.get_location_json | safe }} {% else %} null {% endif %},
            authenticated: '{{ request.user.is_authenticated }}' == 'True',
            userId: {% if request.user.is_authenticated %} {{ request.user.id }} {% else %} null {% endif %},
            defaultImageUrl: "{{ default_image_url }}",
            featured: [
                {% for featured in featured %}
                    { url: "{{ featured.url }}",
                      locationName: "{{ featured.location_name }}",
                      imageUrl: "{{ featured.imageUrl }}",
                      street1: "{{ featured.street1 }}",
                      city: "{{ featured.city }}",
                      state: "{{ featured.state }}",
                      zipCode: "{{ featured.zip_code }}",
                      phone: "{{ featured.phone }}",
                      locationEmail: "{{ featured.location_email }}"
                    }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]
        });
    </script>

{% endblock %}
